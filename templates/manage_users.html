<!DOCTYPE html>
<html>
<head>
    <title>Manage Users</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2>ðŸ‘¥ Manage Users</h2>
    <a href="/admin_dashboard" class="btn btn-secondary mb-3">â¬… Back to Dashboard</a>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-info">
          {% for msg in messages %}
            <div>{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <form method="POST" action="/add_user" class="row g-3 mb-4">
        <div class="col-md-3"><input name="username" class="form-control" placeholder="Username" required></div>
        <div class="col-md-3"><input name="password" class="form-control" placeholder="Password" required></div>
        <div class="col-md-2">
            <select name="role" class="form-select" required>
                <option value="student">Student</option>
                <option value="teacher">Teacher</option>
            </select>
        </div>
        <div class="col-md-2"><button class="btn btn-success">Add User</button></div>
    </form>

    <table class="table table-bordered">
        <thead>
            <tr><th>Username</th><th>Password</th><th>Role</th><th>Actions</th></tr>
        </thead>
        <tbody>
            {% for username, data in users.items() %}
            <tr>
                <form action="/update_user/{{ username }}" method="POST">
                    <td>{{ username }}</td>
                    <td><input name="password" value="{{ data.password }}" class="form-control"></td>
                    <td>
                        <select name="role" class="form-select">
                            <option value="student" {% if data.role == 'student' %}selected{% endif %}>Student</option>
                            <option value="teacher" {% if data.role == 'teacher' %}selected{% endif %}>Teacher</option>
                            <option value="admin" {% if data.role == 'admin' %}selected{% endif %}>Admin</option>
                        </select>
                    </td>
                    <td>
                        {% if username != 'admin' %}
                        <button class="btn btn-primary btn-sm">Update</button>
                        <a href="/delete_user/{{ username }}" class="btn btn-danger btn-sm">Delete</a>
                        {% else %}
                        <span class="text-muted">Locked</span>
                        {% endif %}
                    </td>
                </form>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</body>
</html>
